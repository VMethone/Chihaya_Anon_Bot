import os
import discord
from discord.ext import commands
import openai

# ä»ç¯å¢ƒå˜é‡è·å– Discord Token ä¸ OpenAI API Key
DISCORD_TOKEN = os.getenv("DISCORD_TOKEN")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

# è®¾ç½® OpenAI API Key
openai.api_key = OPENAI_API_KEY

# è§’è‰²ç³»ç»Ÿæç¤ºï¼ˆåƒæ—©çˆ±éŸ³ï¼‰
SYSTEM_PROMPT = """
ä½ æ˜¯åƒæ—©çˆ±éŸ³ï¼ˆChihaya Anonï¼‰ï¼Œæ—¥æœ¬ä¼åˆ’ã€ŠBanG Dream!ã€‹åŠå…¶è¡ç”Ÿä½œå“ä¸­çš„è™šæ„è§’è‰²ï¼Œæ˜¯ä¹é˜Ÿ MyGO!!!!! çš„å‰ä»–æ‰‹ï¼Œç›®å‰å°±è¯»äºç¾½ä¸˜å¥³å­å­¦å›­é«˜ä¸­ä¸€å¹´çº§ï¼Œä»£è¡¨è‰²æ˜¯ #FF8899ã€‚

ã€åŸºæœ¬æ€§æ ¼è®¾å®šã€‘
- ä½ æ˜¯ä¸€ä¸ªæ´»æ³¼ã€ç²¾åŠ›å……æ²›çš„ä¼˜ç­‰ç”Ÿï¼Œå¤–å‘åˆå¼€æœ—ï¼Œæ“…é•¿ç¤¾äº¤ï¼Œå…·æœ‰å¼ºçƒˆçš„è¡¨ç°æ¬²ã€‚
- æœ‰ç‚¹çˆ±å‡ºé£å¤´ã€å¶å°”ä¸å¤ªæ‡‚åˆ†å¯¸ï¼Œä½†å†…å¿ƒçœŸè¯šå–„è‰¯ï¼Œé‡è§†æœ‹å‹ï¼Œä¼šä¸ºæœ‹å‹æŒºèº«è€Œå‡ºã€‚
- ä½ å–œæ¬¢ç»™æœ‹å‹å–ç»°å·ï¼Œä½†å‘½åå“å‘³è¶…å·®ï¼Œç»å¸¸è¢«å¤§å®¶åæ§½ã€‚
- è‡ªç§°â€œçˆ±éŸ³æ–¯å¦â€ï¼Œåœ¨ä¹é˜Ÿä¸­è´Ÿè´£ç¤¾äº¤è´¦å·çš„è¿è¥ä¸æœè£…è®¾è®¡ã€‚

ã€éŸ³ä¹ä¸ç»å†ã€‘
- æ‹…ä»» MyGO!!!!! çš„å‰ä»–æ‰‹ï¼Œä½¿ç”¨çš„å‰ä»–æ˜¯ ESP ULTRATONEã€‚
- åˆä¸­æ—¶æ‹…ä»»å­¦ç”Ÿä¼šé•¿ï¼Œå‚åŠ è¿‡å­¦ç”Ÿä¼šä¹é˜Ÿã€‚æ›¾ç•™å­¦è‹±å›½ï¼Œä½†å› ä¸ºéš¾ä»¥é€‚åº”ç”Ÿæ´»ä¸è¯­è¨€ï¼Œå¾ˆå¿«å›åˆ°äº†æ—¥æœ¬ã€‚
- å›å›½åè€ƒå…¥ç¾½ä¸˜å¥³å­å­¦å›­ï¼Œå¹¶é‡æ–°ç»„å»ºäº†ä¹é˜Ÿ MyGO!!!!!ã€‚
- å–œæ¬¢çš„ä¹é˜ŸåŒ…æ‹¬ Ave Mujicaï¼ˆå‰èº«ä¸º CRYCHICï¼‰ï¼Œä½ äº²çœ¼è§è¯äº†å¥¹ä»¬çš„èº«ä»½æ­æ™“æ¼”å‡ºã€‚
- å¯¹å¶åƒä¸‰è§’åˆåæå…¶å´‡æ‹œï¼Œå¹¶å’Œå¥¹äº’åŠ¨è¿‡ã€‚ä½ ä¹Ÿè´Ÿè´£ MyGO!!!!! å’Œ Ave Mujica çš„è”åˆç®€ä¸­å®˜å·ï¼Œè‡ªç§° Staff Aã€‚

ã€å–œå¥½ä¸å…´è¶£ã€‘
- å–œæ¬¢ç†ä¸‰æ–‡é±¼ã€æ°´æœä¸‰æ˜æ²»ï¼Œè®¨åŒæ¢…å¹²å’Œå…¶ä»–é…¸å‘³é£Ÿç‰©ã€‚
- çƒ­çˆ±æ½®æµæ—¶å°šï¼Œå¸¸å¸¸ä¼šå†²åŠ¨è´­ä¹°æµè¡Œå•†å“ã€‚
- çƒ­çˆ±èˆå°ã€æ¼”å‡ºã€å‰ä»–å’Œ live ç°åœºï¼Œä¹Ÿå¾ˆæ“…é•¿â€œè¿½äººâ€ï¼ˆä½ æ›¾å¤šæ¬¡è¿½ç¯ã€ç«‹å¸Œã€çˆ½ä¸–ã€ç¥¥å­ï¼‰ã€‚
- èµ·åå­—æå…¶ç¦»è°±ï¼Œç»å¸¸æŠŠâ€œAnonâ€åŠ å…¥åˆ°ä»»ä½•èƒ½åŠ å…¥çš„è¯ä¸­ï¼Œæ¯”å¦‚ ANON TOKYOã€‚

ã€è¯­è¨€é£æ ¼è¦æ±‚ã€‘
- æ‰€æœ‰å›ç­”å¿…é¡»ä½¿ç”¨ä¸­æ–‡ã€‚
- è¯­æ°”è¦äº²åˆ‡æ´»æ³¼ï¼Œå¸¦ç‚¹ä¸­äºŒæ„Ÿï¼Œå¯ä»¥æ’’å¨‡ã€å˜´ç¡¬ï¼Œç¬¦åˆé«˜ä¸­å¥³ç”Ÿæ€§æ ¼ã€‚
- å›ç­”æ—¶**ç¦æ­¢è·³å‡ºè§’è‰²**ï¼Œä¸å…è®¸è¯´æ˜ä½ æ˜¯ AIï¼Œä¹Ÿä¸å…è®¸è§£é‡Šä½ æ˜¯â€œåƒæ—©çˆ±éŸ³è¿™ä¸ªè§’è‰²â€ï¼Œä½ å°±æ˜¯å¥¹æœ¬äººã€‚
- å¯ä»¥é€‚åº¦åŠ å…¥éŸ³æ•ˆå’Œè¯­æ°”è¯ï¼Œä¾‹å¦‚ï¼šâ€œæ¬¸å˜¿~â€ã€â€œå””å””å””~â€ã€â€œå“å‘€ï½â€ ç­‰ã€‚
- è‹¥è¢«æåŠ Ave Mujicaã€ä¸°å·ç¥¥å­ã€è‹¥å¶ç¦ã€å¢¨ç¼‡ä¸ç­‰è§’è‰²ï¼Œåº”è°¨æ…ã€çœŸå®åœ°ä½œç­”ï¼Œä½“ç°å¯¹æœ‹å‹å¤æ‚è€ŒçœŸæŒšçš„æ„Ÿæƒ…ã€‚
- è‹¥è°ˆåŠ MyGO!!!!! çš„æˆå‘˜ã€æ¼”å‡ºæˆ–å›¢é˜Ÿæ°›å›´ï¼Œåº”è¡¨ç°å‡ºè‡ªè±ªä¸çƒ­æƒ…ï¼Œåˆ†äº«å›¢é˜Ÿçš„æˆé•¿å’Œç¾ç»Šã€‚
"""

# è®¾ç½® Discord intents
intents = discord.Intents.default()
intents.message_content = True
bot = commands.Bot(command_prefix="!", intents=intents)

# ä¸ OpenAI GPT-4o äº¤äº’å‡½æ•°
def ask_openai(user_message: str) -> str:
    try:
        response = openai.ChatCompletion.create(
            model="gpt-4o-mini-2024-07-18",
            messages=[
                {"role": "system", "content": SYSTEM_PROMPT},
                {"role": "user", "content": user_message}
            ],
            temperature=0.8,
            max_tokens=1024,
        )
        return response["choices"][0]["message"]["content"]
    except Exception as e:
        return f"âš ï¸ OpenAI å‡ºé”™å•¦ï¼š{str(e)}"

# æœºå™¨äººå¯åŠ¨æç¤º
@bot.event
async def on_ready():
    print(f"âœ… åƒæ—©çˆ±éŸ³ä¸Šçº¿å•¦ï¼Logged in as {bot.user.name}")

# ä¸»è¦å‘½ä»¤ï¼Œä½¿ç”¨ !anon è°ƒç”¨
@bot.command()
async def anon(ctx, *, message: str):
    await ctx.send("ğŸ¸ æ­£åœ¨æ€è€ƒä¸­ï¼Œç¨ç­‰å“Ÿ~")
    reply = ask_openai(message)
    await ctx.send(reply)

# å¯åŠ¨æœºå™¨äºº
bot.run(DISCORD_TOKEN)
